{% extends 'base_loggedin.html' %}

{% block content %}
<h1>{{project.name}}</h1>
<p>{{project.description}}</p>
<br/>
{% if user == project.admin %}
<ul class="menu">
    <li><a href="add">Add new task</a></li>
    <li><a href="edit">Edit Project</a></li>
    <li><a href="delete">Delete Project</a></li>
</ul>
{% endif %}

<br/>



<div style="clear: both;"></div>
{% load ganttly_extras %}

<style>
    .clear {width:{{ first_date|countdays:last_date|add:2|multiply:40 }}px;}
</style>

<div style="float:left;">
    <div style="border: none; height: 20px;">
    </div><br/>
    <div style="height: 0px; clear:both;"></div>
{% for task in task_list %}
    <div class="task">
        <a href="{{ task.id }}">{{ task.name }}</a>&nbsp;&nbsp;
    </div>
    <div class="clear_left"></div>
{% endfor %}
</div>

<div class="gantt" style="float:left">
<div class="gantt_container" style="width: {{ first_date|countdays:last_date|add:2|multiply:40 }}px;">
    {% for x in first_date|drawmonths:last_date %}
        {% if x %}
        <div class="month_marker month">{{ x }}</div>
        {% else %}
        <div class="month_marker">{{ x }}</div>
        {% endif %}
    {% endfor %}
<br/>
    {% for x in first_date|drawdays:last_date %}
    <div class="marker">{{ x }}</div>
    {% endfor %}
    <div style="height: 0px; clear:both;"></div>

    {% for task in task_list %}
    {% comment %}
        <div class="task">
            <a href="{{ task.id }}">{{ task.name }}&nbsp;&nbsp;</a>
        </div>
    {% endcomment %}
        <a href="{{ task.id }}">
        <div 
            class="block
            {% if task.is_completed %}
                done
            {% elif task.finish|is_overdue %}
                overdue
            {% elif task.has_started %}
                running
            {% else %}
                upcoming
            {% endif %}
            "
            style="
                width:{{ task.start|countdays:task.finish|add:1|multiply:40 }}px;
                margin-left: {{ first_date|countdays:task.start|multiply:40 }}px
        ">
        </div>
        </a>
        <div class="clear"></div>
    {% endfor %}
</div>
</div>
<div id="key" style="margin-right: 15px; width: 150px; float: right; border: 1px solid #cecece; padding: 3px;">
    <h2>Key</h2>
    <div style=" clear: left;">
        <div class="block upcoming" style="width:20px; margin-right: 10px;"></div>
        <div style="line-height: 30px;">Upcoming</div>
    </div>
    <div style=" clear: left;">
        <div class="block running" style="width:20px; margin-right: 10px;"></div>
        <div style="line-height: 30px;">Running</div>
    </div>
    <div style=" clear: left;">
        <div class="block done" style="width:20px; margin-right: 10px;"></div>
        <div style="line-height: 30px;">Done</div>
    </div>
    <div style=" clear: left;">
        <div class="block overdue" style="width:20px; margin-right: 10px;"></div>
        <div style="line-height: 30px;">Overdue</div>
    </div>
</div>

<div style="clear: left;"></div>

<br/>

<dl>
    <dt>Comments</dt>
        <dd>
            <form action="../{{ action }}/" method="post">
                {% csrf_token %}
                {% include "form_snippet.html" %}
                <p><input type="submit" value="{{ button }}" /></p>
            </form>
            <br/>
            <ul class="comments">
                {% for comment in comments %}
                <li>
                    <b>{{ comment.user.first_name }} {{ comment.user.last_name }}</b><br/>
                    <i>{{ comment.posted }}</i><br/>
                    <p>
                        {{ comment.comment }}
                    </p>
                </li>
                {% endfor %}
            </ul>
        </dd>
</dl>

{% endblock content %}